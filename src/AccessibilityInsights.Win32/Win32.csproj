<Project Sdk="Microsoft.NET.Sdk">

  <PropertyGroup>
    <AssemblyName>AccessibilityInsights.Win32</AssemblyName>
    <RootNamespace>AccessibilityInsights.Win32</RootNamespace>
  </PropertyGroup>

  <PropertyGroup>
    <Revision Condition=" '$(BUILD_BUILDNUMBER)' != '' ">$(BUILD_BUILDNUMBER.Substring($(BUILD_BUILDNUMBER.LastIndexOf(`.`))))</Revision>
    <Revision Condition=" '$(BUILD_BUILDNUMBER)' == '' ">.1</Revision>
    <CurrentDateString Condition=" '$(BUILD_BUILDNUMBER)' != '' ">$(BUILD_BUILDNUMBER.Substring(0, $(BUILD_BUILDNUMBER.LastIndexOf(`.`))))</CurrentDateString>
    <CurrentDateString Condition=" '$(BUILD_BUILDNUMBER)' == '' ">$([System.DateTime]::Now.ToString(`yyyy-MM-dd`))</CurrentDateString>
    <CountDate>$([System.DateTime]::ParseExact(`2017-01-01`,`yyyy-MM-dd`,null))</CountDate>
    <BuildNumber>1.1.$([System.Math]::Round($([System.DateTime]::ParseExact($(CurrentDateString),`yyyy-MM-dd`,null).Subtract($(CountDate)).TotalDays)).ToString(`0000`))$(Revision)</BuildNumber>
  </PropertyGroup>

  <Target Name="CreateVersionFile" BeforeTargets="BeforeCompile">
    <WriteLinesToFile File="$(MSBuildProjectDirectory)\..\bld\A11yInsightsVersionInfo.cs"
                      Condition="!Exists('$(MSBuildProjectDirectory)\..\bld\A11yInsightsVersionInfo.cs')"
                      Lines="[assembly: System.Reflection.AssemblyVersion(&quot;$(BuildNumber)&quot;)] // Generated by build"
                      Overwrite="True" />
  </Target>

  <Target Name="CreateAttributesFile" BeforeTargets="BeforeCompile">
    <WriteLinesToFile File="$(MSBuildProjectDirectory)\..\bld\A11yInsightsAttributesInfo.cs"
                      Condition="!Exists('$(MSBuildProjectDirectory)\..\bld\A11yInsightsAttributesInfo.cs')"
                      Lines="[assembly: System.CLSCompliant(false)] // Generated by build"
                      Overwrite="True" />
  </Target>

  <Target Name="CleanSolutionBldFolder" BeforeTargets="CoreClean">
    <Exec Command="if exist $(MSBuildProjectDirectory)\..\bld rd /s /q $(MSBuildProjectDirectory)\..\bld"/>
  </Target>

  <Import Project="..\..\build\NetFrameworkRelease.targets" />

</Project>
